<UserControl x:Class="HCWpfFramework.Controls.DockingPanel"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
xmlns:controls="clr-namespace:HCWpfFramework.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    <UserControl.Resources>
        <DataTemplate x:Key="DockableWindowTemplate">
            <controls:DockableContent WindowData="{Binding}" 
                                      WindowFloatRequested="DockableContent_WindowFloatRequested"
                                      WindowCloseRequested="DockableContent_WindowCloseRequested"/>
        </DataTemplate>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Panel Header -->
        <Border Grid.Row="0" 
                Background="{DynamicResource DockingPanelHeaderBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,0,0,1"
                Padding="8,4">
            <TextBlock Text="{Binding PanelTitle}" 
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource PrimaryTextBrush}"
                       VerticalAlignment="Center"/>
        </Border>
        
        <!-- TabControl for dockable windows -->
        <TabControl Grid.Row="1" 
                    x:Name="WindowTabControl"
                    ItemsSource="{Binding DockableWindows}"
                    ContentTemplate="{StaticResource DockableWindowTemplate}"
                    AllowDrop="True"
                    Drop="TabControl_Drop"
                    DragOver="TabControl_DragOver"
                    DragLeave="TabControl_DragLeave"
                    Style="{StaticResource ThemedTabControlStyle}">
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding Title}" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,4,0"
                                   Foreground="{DynamicResource TabTextBrush}"/>
                        <Button Content="?" 
                                Width="16" Height="16"
                                FontSize="8"
                                Click="TabCloseButton_Click"
                                CommandParameter="{Binding}"
                                Style="{StaticResource ThemedButtonStyle}"
                                ToolTip="Close Tab"/>
                    </StackPanel>
                </DataTemplate>
            </TabControl.ItemTemplate>
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem" BasedOn="{StaticResource ThemedTabItemStyle}">
                    <EventSetter Event="MouseMove" Handler="TabItem_MouseMove"/>
                </Style>
            </TabControl.ItemContainerStyle>
        </TabControl>
        
        <!-- Drop zone indicator -->
        <Border x:Name="DropZoneIndicator" 
                Grid.Row="1"
                Background="{DynamicResource DropZoneBackgroundBrush}" 
                Opacity="0"
                Visibility="Collapsed"
                BorderBrush="{DynamicResource DropZoneBorderBrush}"
                BorderThickness="3"
                CornerRadius="5">
            <Border.Effect>
                <DropShadowEffect Color="Blue" BlurRadius="10" ShadowDepth="0" Opacity="0.5"/>
            </Border.Effect>
            
            <!-- Animation for smooth appearance -->
            <Border.Style>
                <Style TargetType="Border">
                    <Style.Triggers>
                        <Trigger Property="Visibility" Value="Visible">
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                       From="0" To="0.4"
                                                       Duration="0:0:0.15"
                                                       AccelerationRatio="0.5"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                            <Trigger.ExitActions>
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                       From="0.4" To="0"
                                                       Duration="0:0:0.1"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.ExitActions>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>
            
            <TextBlock Text="Drop Here" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="{DynamicResource DropZoneBorderBrush}"/>
        </Border>
    </Grid>
</UserControl>